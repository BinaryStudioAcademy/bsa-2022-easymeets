<div class="calendar-container">
    <button (click)="confirmDialog()" class="connect-new"><mat-icon>add</mat-icon> Connect New Calendars</button>

    <div class="table-container">
        <table mat-table [dataSource]="userCalendars" class="mat-elevation-z8">
            <!-- Emails Column -->
            <ng-container matColumnDef="connected-calendars">
                <th mat-header-cell *matHeaderCellDef>Connected Calendar</th>
                <td mat-cell *matCellDef="let element">
                    <div class="email-wrapper">
                        <button (click)="removeCalendar(element.id)"><mat-icon class="cancel">cancel</mat-icon></button>

                        <div class="email">{{ element.connectedCalendar }}</div>
                    </div>
                </td>
            </ng-container>

            <!-- Events for Column -->
            <ng-container matColumnDef="events-for">
                <th mat-header-cell *matHeaderCellDef>Event names visible for</th>
                <td mat-cell *matCellDef="let element">
                    <mat-form-field class="mat-select-form" appearance="fill">
                        <mat-label *ngIf="!element.visibleForTeams?.length">None</mat-label>
                        <mat-select
                            [(ngModel)]="element.visibleForTeams"
                            (ngModelChange)="(element.visibleForTeams)"
                            name="selectedTeams"
                            multiple>
                            <mat-select-trigger
                                *ngIf="
                                    element.visibleForTeams?.length >= 2 &&
                                    element.visibleForTeams?.length !== allTeams?.length
                                ">
                                {{ element.visibleForTeams?.length }} Teams
                            </mat-select-trigger>
                            <mat-select-trigger *ngIf="element.visibleForTeams?.length === allTeams?.length">
                                All teams
                            </mat-select-trigger>
                            <mat-option *ngFor="let team of allTeams" [value]="team">{{ team.name }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </td>
            </ng-container>

            <!-- Events from Column -->
            <ng-container matColumnDef="events-from">
                <th mat-header-cell *matHeaderCellDef>Add event from</th>
                <td mat-cell *matCellDef="let element">
                    <mat-form-field class="mat-select-form" appearance="fill">
                        <mat-label *ngIf="!element.importEventsFromTeam">None</mat-label>
                        <mat-select
                            [(ngModel)]="element.importEventsFromTeam"
                            (ngModelChange)="(element.importEventsFromTeam)">
                            <mat-option *ngFor="let team of allTeams" [value]="team">
                                {{ team.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </td>
            </ng-container>

            <!-- Check Column -->
            <ng-container matColumnDef="check">
                <th mat-header-cell *matHeaderCellDef>Check for conflicts</th>
                <td mat-cell *matCellDef="let element">
                    <mat-form-field class="mat-select-form" appearance="fill">
                        <mat-select
                            [(ngModel)]="element.checkForConflicts"
                            (ngModelChange)="(element.checkForConflicts)">
                            <mat-option *ngFor="let option of checkOptions" [value]="option.value">
                                {{ option.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
    </div>

    <button (click)="updateCalendar()" class="update-references">Update References</button>
</div>
